# README

## Meta

All `*.uc`, `*.ucxt`, and `*.uca` files are different forms of usecode -- scripting languages meant to be transformed into Usecode bytecode to be used in the game engines of:

* Ultima VII: The Black Gate ("BG")
* Ultima VII: The Forge of Virtue ("FOV")
* Ultima VII Part 2: The Serpent Isle Beta ("SIB")
* Ultima VII Part 2: The Serpent Isle ("SI")
* Ultima VII Part 2: The Silver Seed ("SS")
* Exult (an open-source, white-box reverse engineered recreation of those engines for modern computers and operating systems)

Some of these games had official translations:

* BG was translated into German ("BGDE"), Spanish ("BGES"), and French ("BGFR")
* SI was translated into Spanish ("SIES")

## Tools

* `ucc`: The Usecode C Compiler, a compiler created by Exult team. This will compile input files into Usecode bytecode. `ucc` can generate Exult-specific opcodes that don't work on the original games -- but there is a subset of Usecode C that will generated bytecode can be used directly in the original games.

* `wuc`: Wody's UseCode assembler, a compiler originally written by Wody and donated to Exult team, which now maintains it. It uses a custom assembly language that maps directly into usecode bytecode. It accepts mnemonics of Exult-specific opcodes.

* `ucxt`: UseCode eXtractor Tool, a disassembler/decompiler that can extract the usecode of the original games into low-level formats that can be fed into either `ucc`, or `wuc`, depending on flags.

## File formats

* `*.uc`: These are Usecode C files, a high-level C++-inspired scripting language created by the Exult team and designed to be compiled into usecode byte-code with `ucc`. These files are meant to be written by humans, and has friendlier control flow structures and abstractions.

* `*.ucxt`: These are Usecode C files extracted by `ucxt`. This is a proper-subset of Usecode C which is output by `ucxt`, and typically closely matches the input usecode bytecode. It is generally not meant to be written by people -- instead, people will start with a `*.ucxt` file and massage it into an `*.uc` file, using the fact that `ucc` accepts `ucxt` output.

* `*.uca`: These are Usecode Assembly files, an assembly language created by the Exult team and designed to be assembled into usecode byte-code with `wuc`.

## Usecode Syntax Notes

The syntax for this language is documented in [EBNF notation](usecode-syntax.ebnf). A simplified version of the Bison implementation is also present in [this file](usecode-syntax.yy).

Usecode Intrinsics are functions exported by the game engine to the scripting engine. Their name typically starts with "UI_" (for "Usecode Intrinsic). They can also be called in object notation without the preceding "UI_": for example, the following two lines are identical:

    UI_in_usecode(obj)
    obj->in_usecode()

There is a documentation on intrinsics in [this file](exult_intrinsics.txt).

## File structure

* `uca` directory: contains Usecode assembly files extracted from the original games, for comparative analysis. In particular, the SIES game had debug opcodes in the final Usecode bytecode, and so this one is dumped as assembly to be inspected.
* `ucxt` directory: contains Usecode C files extracted from the original games, for comparative analysis.
* `fov` and `ss` directories: contains an in-progress manual conversion of `usecode.fov.ucxt` and `usecode.ss.ucxt` to a higher-level version suitable for people to use.

## Testing instructions

The main files can be built with `make fov` or `make ss`. They can be checked with `make check.fov` or `make check.ss`. Doing a plain `make` or `make all` will build and check both `fov` and `ss`, while a `make check` is equivalent to doing `make check.fov check.ss`.

A `make ref` can be used to build the reference files used by `check.fov` and `check.ss`, but this should probably never used.

Due to the fact that `ucc` does a few optimizations when compiling usecode, the high-level file needs to be compiled without symbols, extracted with `ucxt`, the extracted output must be recompiled with `ucc`, and the output of this is extracted with `ucxt`. This is done when generating the reference files in `make ref`, as well as when doing `make fov` or `make ss`.
